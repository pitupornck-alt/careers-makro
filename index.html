<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</title>

  <style>
    :root { --max: 1100px; }
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", sans-serif; background:#f6f7fb; color:#111; }
    header { padding:64px 18px; color:#fff; background: linear-gradient(120deg, #4f46e5, #6366f1); }
    header .wrap { max-width: var(--max); margin:auto; }
    header h1 { margin:0 0 8px; font-size:40px; }
    header p { margin:0; font-size:18px; opacity:.95; }

    main { max-width: var(--max); margin:auto; padding:24px 18px 60px; }
    .card { background:#fff; border-radius:16px; padding:18px; box-shadow:0 10px 28px rgba(0,0,0,.08); margin-bottom:16px; }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .pill { background:#eef2ff; color:#3730a3; font-weight:700; font-size:13px; padding:6px 12px; border-radius:999px; }
    .muted { opacity:.7; }

    input, select { padding:10px 12px; border-radius:12px; border:1px solid rgba(0,0,0,.15); font-size:14px; }
    .btn { border:0; border-radius:12px; padding:10px 16px; font-weight:700; cursor:pointer; }
    .btn.primary { background:#111827; color:#fff; }
    .btn.ghost { background:#eef2ff; color:#3730a3; }

    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:12px; margin-top:12px; }
    .job { border:1px solid rgba(0,0,0,.1); border-radius:14px; padding:14px; }
    .job h3 { margin:0 0 6px; font-size:18px; }
    .meta { font-size:13px; opacity:.9; }
    .meta div { margin:2px 0; }

    iframe { width:100%; height:1200px; border:0; border-radius:16px; }
  </style>
</head>

<body>

<header>
  <div class="wrap">
    <h1>‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</h1>
    <p>‡∏î‡∏π‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ß‡πà‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô)</p>
  </div>
</header>

<main>

  <section class="card">
    <div class="row" style="justify-content:space-between">
      <div>
        <span class="pill">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ß‡πà‡∏≤‡∏á</span>
        <div class="muted">‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡πÉ‡∏ô GitHub</div>
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <input id="q" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡∏™‡∏≤‡∏Ç‡∏≤)..." style="flex:1;min-width:240px">
      <select id="filterBranch"><option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option></select>
      <button class="btn ghost" id="clearBtn">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
    </div>
  </section>

  <section class="card">
    <div id="summary" class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
    <div id="jobs" class="grid"></div>
  </section>

  <section class="card" id="apply">
    <span class="pill">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô</span>
    <p class="muted">‡∏Å‡∏£‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
    <iframe id="applyFrame" loading="lazy"></iframe>
  </section>

</main>

<script>
/* ================= CONFIG ================= */
const CSV_URL = "./" + encodeURI("‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≤‡∏Ç‡∏≤.csv");

// üîπ Microsoft Form (Base)
const FORM_BASE = "https://forms.office.com/r/wabJfczd4Z";

// üîπ ‡πÉ‡∏™‡πà ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏à‡∏≤‡∏Å pre-filled link
// ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: https://forms.office.com/r/xxxx?entry.123=...
const FORM_FIELD_POSITION = "entry.111111111"; // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£
const FORM_FIELD_BRANCH   = "entry.222222222"; // ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤

/* ================= CSV ================= */
function detectDelimiter(t){
  const h=(t.split(/\r?\n/)[0]||"");
  const tab=(h.match(/\t/g)||[]).length, comma=(h.match(/,/g)||[]).length;
  return tab>comma ? "\t" : ",";
}
function parse(t,d){
  const r=[]; let row=[],c="",q=false;
  for(let i=0;i<t.length;i++){
    const x=t[i],n=t[i+1];
    if(x=='"'){ if(q&&n=='"'){c+='"';i++;} else q=!q; continue;}
    if(!q&&x==d){ row.push(c.trim()); c=""; continue;}
    if(!q&&(x=='\n'||x=='\r')){
      if(x=='\r'&&n=='\n')i++;
      row.push(c.trim()); if(row.some(v=>v))r.push(row);
      row=[]; c=""; continue;
    }
    c+=x;
  }
  if(c||row.length){ row.push(c.trim()); if(row.some(v=>v))r.push(row);}
  return r;
}

/* ================= MAP ================= */
const norm=s=>(s||"").replace(/\s+/g,"").toLowerCase();
function headerIndex(h){
  const m={}; h.forEach((x,i)=>m[norm(x)]=i);
  const pick=a=>a.find(x=>norm(x)in m)!=null?m[norm(a.find(x=>norm(x)in m))]:-1;
  return {
    position: pick(["‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£"]),
    branch:   pick(["‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤"])
  };
}

let rows=[];

/* ================= RENDER ================= */
function render(){
  const qv=q.value.toLowerCase(), bv=filterBranch.value;
  const list=rows.filter(r=>{
    return (!qv||(`${r.position} ${r.branch}`).toLowerCase().includes(qv))
      &&(!bv||r.branch===bv);
  });

  summary.textContent=`‡∏û‡∏ö ${list.length} ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${rows.length})`;

  jobs.innerHTML=list.map(r=>`
    <div class="job">
      <h3>${r.position}</h3>
      <div class="meta">
        <div>‡∏™‡∏≤‡∏Ç‡∏≤: ${r.branch}</div>
      </div>
      <button class="btn primary" onclick="applyJob('${r.position}','${r.branch}')">
        ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ô‡∏µ‡πâ
      </button>
    </div>
  `).join("");
}

function applyJob(position, branch){
  const url =
    FORM_BASE + "?"
    + FORM_FIELD_POSITION + "=" + encodeURIComponent(position) + "&"
    + FORM_FIELD_BRANCH   + "=" + encodeURIComponent(branch);

  applyFrame.src = url;
  document.getElementById("apply").scrollIntoView({behavior:"smooth"});
}

/* ================= LOAD ================= */
async function load(){
  const res=await fetch(CSV_URL+"?t="+Date.now());
  const txt=await res.text();
  const d=detectDelimiter(txt);
  const r=parse(txt,d);
  const idx=headerIndex(r[0]);

  rows=r.slice(1).map(x=>({
    position:x[idx.position],
    branch:x[idx.branch]
  }));

  [...new Set(rows.map(r=>r.branch))].forEach(b=>{
    filterBranch.insertAdjacentHTML("beforeend",`<option>${b}</option>`);
  });

  render();
}

q.oninput=render;
filterBranch.onchange=render;
clearBtn.onclick=()=>{q.value="";filterBranch.value="";render();};

load();
</script>

</body>
</html>
